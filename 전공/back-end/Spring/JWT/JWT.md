dJWT(Json Web Token) 이란?
**Json 형식을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반 web Token** 이다. 
**토큰 자체를 정보로 사용하는 Self-Contained 방식으로 정보를 안전하게 처리**

## 개념
>정보를 비밀리에 전달하거나 인증할 때 주로 사용하는 토큰으로.Json객체를 이용함.

일반적으로 클라와 서버 사이에서 통신할 때 내가 ==그사람이 맞는지,권한== 을 위해 사용하는 토큰이다. json 형태로 정보를 주고 받고, 복잡하고 읽을 수 없는 string 형태로 저장되어 있다.

### JWT
JWT는 **헤더(header)**, 페이로드(payload), 서명(signature) 세파트로 나누어저져 있다.
![[jwt부분.png]]

* **헤더(Header)** 
> 어떠한 알고리즘으로 암호화 할 것인지, 어떠한 토큰을 사용할 것인지(메타데이터)가 들어있다.

* **정보(Payload)**
>전달하려는 정보{사용자 id나 다른 데이터들(클래임)}가 들어있다. Payload 에 들어있는 내용은 수정,추가 가능, 그러나 노출,수정이 가능한 지점이기 때문에 최소한의 정보(id,pw 가 아닌 토큰을 가졌을 때의 권한범위, 만료일자 등)만을 담아야 한다.

* **서명(Signature)**
>가장 중요한 부분으로 ==header와 payload를 합친 후 발급해준 서버가 지정한 secret key로 토큰을 암호화== 시켜 토큰을 변조하기 어렵게 만들어줌. 
>-> 만약 누군가 payload 의 내용을 조작함. 하지만 Signature 에는 조작되기 전의 payload값과 header값을 합친 값이 저장되어 있기 때문에 조작된 payload 값과는 다른 결과가 나옴 
>-> 조작되어있는지 쉽게 확인할 수 있고, 다른 누군가가 조작된 토큰을 악용하기 어려워짐 

### JWT 동작 원리
JWT의 동작원리

![[jwt.png]]
1. 사용자가 로그인 정보를 입력함(Id,Password) 
2. 입력한 정보를 DB에 있는 정보와 대조하면서 실제로 사용자가 있는지 확인.
3. 실제 있는 사용자면 Access Token(JWT)를 발급(Refresh Token도 발급.)
4. 사용자에게 AccessToken,RefreshToken 을 전달함.(클라는 이 토큰들을 로컬에 저장함)
5. 사용자가 요청을 할시 AccessToken 을 헤더에 넣어 보냄.
6. 요청을 확인하고 서버에서 사용자 정보를 확인함
7. 엑세스토큰이 정상이면 서버는 요청에 응답함.

8. 만약 시간이 지나 `Access Token`의 유효기간이 만료되면.
>8.1 사용자는 권한이 없는 사용자가 됨.
>8.2 클라이언트로 부터 유효기간이 지난` Access Token`을 받은 서버는 401 (Unauthorized) 에러코드로 **응답**함.
>8.3 401오류 를 통해 클라이언트는 `invalid_token`(유효기간이 만료되었음)을 알 수 있다.
9. `Access Token` 대신 `Refresh Token`을 헤더에 넣어 **서버를 재요청**한다.
10. `Refresh Token` 으로 사용자 권한을 확인한 서버는 **응답쿼리 헤더**에 새로운 `Access Token` 을 넣어 응답함.
11. 만약 `Refresh Token` 도 만료됬을 시 서버는 동일하게 401 error code를 보내고, 클라이언트는 재로그인 해야함.

